#!/usr/bin/env python3

# T: Concept Graph
# Jonathan Gordon

import sys

from gensim.models.wrappers import LdaMallet

from t.corpus import GensimCorpus


# Parameters

MALLET_PATH = 'ext/mallet'
MALLET_BIN = MALLET_PATH + '/bin/mallet'

LDA_TOPICS = 30 #300
LDA_ITERATIONS = 100 #1000

###

if __name__ == '__main__':
    if len(sys.argv) != 2:
        print('Usage: concept-graph [corpus dir.]', file=sys.stderr)
        sys.exit(1)

    corpus = GensimCorpus('bigram', stop=MALLET_PATH + '/stoplists/en.txt')
    corpus.load(sys.argv[1])

    # Print the bigrams in the corpus:
#    for doc_bigrams in corpus:
#        for (bigram, count) in doc_bigrams:
#            print(corpus.dictionary[bigram])

    model = LdaMallet(MALLET_BIN, corpus, num_topics=LDA_TOPICS,
                      id2word=corpus.dictionary, iterations=LDA_ITERATIONS)

    # Mallet output files:
    print(model.fdoctopics())
    print(model.finferencer())
    print(model.fstate())
    print(model.ftopickeys())
    print(model.fwordweights())
